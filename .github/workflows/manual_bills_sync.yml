name: manual_bills_sync

on:
  workflow_dispatch:
    inputs:
      from_date:
        description: 'Start date (YYYY-MM-DD)'
        required: true
        type: string
      to_date:
        description: 'End date (YYYY-MM-DD)'
        required: true
        type: string
      entity:
        description: 'Entity to extract (bills, products, customers, orders, all)'
        required: false
        default: 'all'
        type: string

env:
  PROJECT_ID: sync-nhanhvn-project
  SERVICE_NAME: nhanh-etl-job
  REGION: asia-southeast1

jobs:
  manual_bills_sync:
    permissions:
      contents: read
      id-token: write

    runs-on: ubuntu-latest
    steps:
      - id: 'auth'
        name: 'Authenticate to Google Cloud'
        uses: 'google-github-actions/auth@v2'
        with:
          credentials_json: '${{ secrets.GCP_SA_KEY }}'

      - name: 'Set up Cloud SDK'
        uses: 'google-github-actions/setup-gcloud@v2'

      - name: 'Execute Cloud Run Job'
        run: |
          gcloud run jobs execute $SERVICE_NAME \
            --region=$REGION \
            --args="--platform=nhanh,--entity=${{ inputs.entity }},--from-date=${{ inputs.from_date }},--to-date=${{ inputs.to_date }}"

      - name: 'Job Execution Summary'
        run: |
          echo "âœ… Job execution completed!"
          echo "Date Range: ${{ inputs.from_date }} to ${{ inputs.to_date }}"
          echo "Entity: ${{ inputs.entity }}"

